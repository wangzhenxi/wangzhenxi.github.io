<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Go语言圣经 | Joshwong | 王震西</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="记录点滴">
    
    <link rel="preload" href="/assets/css/0.styles.ff0094b3.css" as="style"><link rel="preload" href="/assets/js/app.9feba9da.js" as="script"><link rel="preload" href="/assets/js/2.c4d23e8d.js" as="script"><link rel="preload" href="/assets/js/1.5c0c4e06.js" as="script"><link rel="preload" href="/assets/js/46.2896505d.js" as="script"><link rel="prefetch" href="/assets/js/10.d1978e44.js"><link rel="prefetch" href="/assets/js/11.9b1c9275.js"><link rel="prefetch" href="/assets/js/12.196947be.js"><link rel="prefetch" href="/assets/js/13.ac03d358.js"><link rel="prefetch" href="/assets/js/14.46fb2ccd.js"><link rel="prefetch" href="/assets/js/15.61f4cd8b.js"><link rel="prefetch" href="/assets/js/16.02db63e5.js"><link rel="prefetch" href="/assets/js/17.67b8a9ac.js"><link rel="prefetch" href="/assets/js/18.d8fd2f38.js"><link rel="prefetch" href="/assets/js/19.c701955f.js"><link rel="prefetch" href="/assets/js/20.09a6a7b1.js"><link rel="prefetch" href="/assets/js/21.2004c2fc.js"><link rel="prefetch" href="/assets/js/22.bb31f0f1.js"><link rel="prefetch" href="/assets/js/23.5b602ccb.js"><link rel="prefetch" href="/assets/js/24.a1e14fd2.js"><link rel="prefetch" href="/assets/js/25.16f87990.js"><link rel="prefetch" href="/assets/js/26.8b1f701a.js"><link rel="prefetch" href="/assets/js/27.acd66555.js"><link rel="prefetch" href="/assets/js/28.d1ef70ed.js"><link rel="prefetch" href="/assets/js/29.db884d36.js"><link rel="prefetch" href="/assets/js/3.236744b7.js"><link rel="prefetch" href="/assets/js/30.95ba78de.js"><link rel="prefetch" href="/assets/js/31.16964dc9.js"><link rel="prefetch" href="/assets/js/32.53d1fbe1.js"><link rel="prefetch" href="/assets/js/33.36f1ad2d.js"><link rel="prefetch" href="/assets/js/34.85556e8b.js"><link rel="prefetch" href="/assets/js/35.3663f985.js"><link rel="prefetch" href="/assets/js/36.3ce9f769.js"><link rel="prefetch" href="/assets/js/37.d1e41c63.js"><link rel="prefetch" href="/assets/js/38.99f22613.js"><link rel="prefetch" href="/assets/js/39.4fa35855.js"><link rel="prefetch" href="/assets/js/4.dbb9d708.js"><link rel="prefetch" href="/assets/js/40.93092765.js"><link rel="prefetch" href="/assets/js/41.85b0eb54.js"><link rel="prefetch" href="/assets/js/42.7d31280f.js"><link rel="prefetch" href="/assets/js/43.8fa6ca36.js"><link rel="prefetch" href="/assets/js/44.e57dc644.js"><link rel="prefetch" href="/assets/js/45.22473998.js"><link rel="prefetch" href="/assets/js/47.f5105d7b.js"><link rel="prefetch" href="/assets/js/48.f99f258d.js"><link rel="prefetch" href="/assets/js/49.fd6aa807.js"><link rel="prefetch" href="/assets/js/5.35ceb314.js"><link rel="prefetch" href="/assets/js/50.6d7c5878.js"><link rel="prefetch" href="/assets/js/51.69f5218e.js"><link rel="prefetch" href="/assets/js/52.7fa9a27f.js"><link rel="prefetch" href="/assets/js/53.dc77931c.js"><link rel="prefetch" href="/assets/js/54.a5ab5c68.js"><link rel="prefetch" href="/assets/js/55.72e610b5.js"><link rel="prefetch" href="/assets/js/56.f9534c2f.js"><link rel="prefetch" href="/assets/js/57.5a70c337.js"><link rel="prefetch" href="/assets/js/58.3327eeec.js"><link rel="prefetch" href="/assets/js/59.313ccf58.js"><link rel="prefetch" href="/assets/js/6.c8a326bf.js"><link rel="prefetch" href="/assets/js/60.6648ca56.js"><link rel="prefetch" href="/assets/js/61.f6b8371e.js"><link rel="prefetch" href="/assets/js/62.1ddcce82.js"><link rel="prefetch" href="/assets/js/63.878e4dbc.js"><link rel="prefetch" href="/assets/js/64.bdf0b3a1.js"><link rel="prefetch" href="/assets/js/65.92366711.js"><link rel="prefetch" href="/assets/js/66.7a588743.js"><link rel="prefetch" href="/assets/js/67.b37b1d9b.js"><link rel="prefetch" href="/assets/js/68.f2d36509.js"><link rel="prefetch" href="/assets/js/69.191a3d8b.js"><link rel="prefetch" href="/assets/js/7.f5aa6fc8.js"><link rel="prefetch" href="/assets/js/70.4706951b.js"><link rel="prefetch" href="/assets/js/71.e73e01fa.js"><link rel="prefetch" href="/assets/js/72.952986dc.js"><link rel="prefetch" href="/assets/js/73.94141cd4.js"><link rel="prefetch" href="/assets/js/74.f3e8af0d.js"><link rel="prefetch" href="/assets/js/75.ca16a72f.js"><link rel="prefetch" href="/assets/js/76.5b17d734.js"><link rel="prefetch" href="/assets/js/77.ef01b3df.js"><link rel="prefetch" href="/assets/js/78.64e583fb.js"><link rel="prefetch" href="/assets/js/79.a98ecfcd.js"><link rel="prefetch" href="/assets/js/80.d5365add.js"><link rel="prefetch" href="/assets/js/81.9ee30d83.js"><link rel="prefetch" href="/assets/js/82.843a2651.js"><link rel="prefetch" href="/assets/js/83.cd923957.js"><link rel="prefetch" href="/assets/js/84.53926582.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f34bf77b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ff0094b3.css">
    <!-- Google Tag Manager -->
    <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PF595C3K');
    </script>
    <!-- End Google Tag Manager -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K9LXC60XXJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-K9LXC60XXJ');
    </script>
</head>

<body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Joshwong | 王震西</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/wangzhenxi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/wangzhenxi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">关于我</a></li><li><a href="/friend/" class="sidebar-link">友情链接</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>读书笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/book/arduino/" class="sidebar-link">Arduino</a></li><li><a href="/book/bai-hua-qu-kuai-lian/" class="sidebar-link">白话区块链</a></li><li><a href="/book/bian-yi-yuan-li/" class="sidebar-link">编译原理</a></li><li><a href="/book/cai-kang-yong-qing-shang-ke/" class="sidebar-link">蔡康永情商课</a></li><li><a href="/book/cai-wu-zhi-shi/" class="sidebar-link">财务知识</a></li><li><a href="/book/chong-gou/" class="sidebar-link">重构</a></li><li><a href="/book/cong-dian-zi-dao-chan-pin/" class="sidebar-link">从点子到产品</a></li><li><a href="/book/cong-ling-kai-shi-xue-jia-gou/" class="sidebar-link">从零开始学架构</a></li><li><a href="/book/de-dao/" class="sidebar-link">得到</a></li><li><a href="/book/e-yu/" class="sidebar-link">俄语</a></li><li><a href="/book/fu-ba-ba-qiong-ba-ba/" class="sidebar-link">富爸爸穷爸爸</a></li><li><a href="/book/gao-xiao-ren-shi-de-qi-ge-xi-guan/" class="sidebar-link">高效能人士的七个习惯</a></li><li><a href="/book/go-yu-yan-sheng-jing/" aria-current="page" class="active sidebar-link">Go语言圣经</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/book/go-yu-yan-sheng-jing/#编码知识" class="sidebar-link">编码知识</a></li><li class="sidebar-sub-header"><a href="/book/go-yu-yan-sheng-jing/#计算机基础" class="sidebar-link">计算机基础</a></li><li class="sidebar-sub-header"><a href="/book/go-yu-yan-sheng-jing/#哈希表" class="sidebar-link">哈希表</a></li><li class="sidebar-sub-header"><a href="/book/go-yu-yan-sheng-jing/#并发模型" class="sidebar-link">并发模型</a></li><li class="sidebar-sub-header"><a href="/book/go-yu-yan-sheng-jing/#数据类型-2" class="sidebar-link">数据类型</a></li><li class="sidebar-sub-header"><a href="/book/go-yu-yan-sheng-jing/#todo-2" class="sidebar-link">TODO</a></li></ul></li><li><a href="/book/javascript-she-ji-mo-shi/" class="sidebar-link">Javascript设计模式</a></li><li><a href="/book/jia-gou-jian-jie-zhi-dao/" class="sidebar-link">架构简洁之道</a></li><li><a href="/book/jia-gou-shi-xiu-lian-zhi-dao/" class="sidebar-link">架构师修炼之道</a></li><li><a href="/book/jie-gou-si-kao-li/" class="sidebar-link">结构思考力</a></li><li><a href="/book/ling-ji-chu-xue-hao-ying-yu-yu-fa/" class="sidebar-link">零基础学好英语语法</a></li><li><a href="/book/mu-yang-shao-nian-qi-huan-zhi-lv/" class="sidebar-link">牧羊少年奇幻之旅</a></li><li><a href="/book/mysql-bi-zhi-bi-hui/" class="sidebar-link">MySQL必知必会</a></li><li><a href="/book/qian-duan-jia-gou-she-ji/" class="sidebar-link">前端架构设计</a></li><li><a href="/book/qing-dan-ge-ming/" class="sidebar-link">清单革命</a></li><li><a href="/book/redis-shi-zhan/" class="sidebar-link">Redis实战</a></li><li><a href="/book/ren-zhi-shi-jie-de-jing-ji-xue/" class="sidebar-link">认知世界的经济学</a></li><li><a href="/book/ru-he-yue-du-yi-ben-shu/" class="sidebar-link">如何阅读一本书</a></li><li><a href="/book/she-ying/" class="sidebar-link">摄影</a></li><li><a href="/book/shen-ru-she-ji-mo-shi/" class="sidebar-link">深入设计模式</a></li><li><a href="/book/suan-fa-tu-jie/" class="sidebar-link">算法图解</a></li><li><a href="/book/web-ying-yong-an-quan/" class="sidebar-link">Web应用安全</a></li><li><a href="/book/xie-gei-nan-ren-de-di-yi-ben-huai-yun-shu/" class="sidebar-link">写给男人的第一本怀孕书</a></li><li><a href="/book/xue-zhao-feng-jing-ji-xue/" class="sidebar-link">薛兆丰的经济学</a></li><li><a href="/book/yue-li/" class="sidebar-link">乐理</a></li><li><a href="/book/zeng-zhang-hei-ke/" class="sidebar-link">增长黑客</a></li><li><a href="/book/zhi-xing/" class="sidebar-link">知行</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>随笔</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="go语言圣经"><a href="#go语言圣经" class="header-anchor">#</a> Go语言圣经</h1> <h2 id="编码知识"><a href="#编码知识" class="header-anchor">#</a> 编码知识</h2> <ul><li>1byte = 8bits 1个字节等于8个位</li> <li>1个字 = 32bits(在32位操作系统下) 或者 64bits(在64位操作系统下)</li> <li>ASCII编码： 使用1个byte存储一个字符，英文字符集</li> <li>GB2312编码： 由2个字节组成，第一个字节存储区码，第二个字节存储位码，两者结合对应某一个字符</li> <li>unicode编码： 各国有自己的字符集后，为了实现跨语言、跨平台的文本转换和处理需求，ISO国际标准化组织提出了Unicode的新标准，涵盖了世界上所有的文字和符号字符，Unicode编码方案为字符集中的每一个字符指定了统一且唯一的二进制编码</li> <li>utf8编码： 是一种变长编码方案，用1～6个字节标识一个字符</li></ul> <h3 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h3> <ul><li>int8、int16、int32: 类型后面带的是bit，所以int8占用1个字节，以此类推</li></ul> <h3 id="utf8编码规则"><a href="#utf8编码规则" class="header-anchor">#</a> UTF8编码规则</h3> <ul><li>如果只有1个字节，最高位为0。</li> <li>如果有n个字节，第一个字节的前n位为1，其余字节以10开头。</li></ul> <h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h4> <blockquote><p>?代表可用于表达编码的位数</p></blockquote> <ul><li>0 ~ 2^8 - 1 : 0??????? 占用1个字节 可表达最高127的数字</li> <li>2^8 ~ 2^12 - 1 : 110????? 10?????? 占用2个字节 可表达最高2047的数字</li> <li>2^12 - 2^16 - 1 : 1110???? 10?????? 10?????? 可表达最高65535的数字</li></ul> <h4 id="引申"><a href="#引申" class="header-anchor">#</a> 引申</h4> <p>string字符串：</p> <p>GO语言中的字符串是会记录存储的字符的字节长度，当修改变量指定位置的值时，会修改变量存储字节长度，所以变量值是只读的，不可修改，如需修改，可直接把变量重新赋值。</p> <h2 id="计算机基础"><a href="#计算机基础" class="header-anchor">#</a> 计算机基础</h2> <ul><li>CPU通过地址总线向内存获取数据： 32位地址总线可寻址 2^32 -1 的地址</li> <li>内存通过数据总线向CPU提供数据： 32位数据总线每次可返回4个字节的数据</li> <li>机器字长： 内存每次向CPU所提供的数据字节数</li> <li>内存寻址： 并行地从内存8个芯片上同时寻找同一个地址的数据，所以地址需为内存芯片数的倍数</li> <li>内存对齐： 编译器将各种类型的数据放到相应合适的位置，并占用相应字节数，比如类型大小为4个字节的，内存位置需取n%4=0的位置</li> <li>对齐边界 = 数据所占字节数 与 机器字长 间取最小值</li> <li>最大对齐边界 = 机器字长</li></ul> <h3 id="引申-2"><a href="#引申-2" class="header-anchor">#</a> 引申</h3> <p>struct结构体：</p> <ul><li>结构体对齐边界 = 所有成员中最大的对齐边界</li> <li>类型大小 = 按顺序取元素内存位置之和，值需等于结构体对齐边界的整数倍</li></ul> <h2 id="哈希表"><a href="#哈希表" class="header-anchor">#</a> 哈希表</h2> <p>通过多个buckets存储键值对</p> <h3 id="实现逻辑"><a href="#实现逻辑" class="header-anchor">#</a> 实现逻辑</h3> <ul><li>通过hash函数将key处理一下，得到一个哈希值</li> <li>key的存储地址，通过哈希值进行取模法或与运算的方式得到</li> <li>新的key如果存储地址被占用，通过比对key是否相等</li> <li>如果不相等（哈希冲突），可通过开放地址法，遍历该地址之后的桶，直到key相等，或者桶不存在，得到存储地址；或者通过拉链法，在地址后新建一个桶，通过链表的方式遍历</li> <li>哈希冲突会影响哈希表读写效率，所以需适时进行哈希表的扩容</li> <li>哈希表扩容时，可通过渐进式扩容的方式，在哈希表读写时，完成一部分键值的迁移，直到全部迁移完成，旧桶不再使用，该方式可防止迁移造成的瞬时抖动。</li></ul> <h2 id="并发模型"><a href="#并发模型" class="header-anchor">#</a> 并发模型</h2> <blockquote><p>DO NOT COMMUNICATE BY SHARING MEMORY; INSTEAD, SHARE MEMORY BY COMMUNICATING.
“不要以共享内存的方式来通信，相反，要通过通信来共享内存。”</p></blockquote> <p>CSP（communicating sequential processes）并发模型</p> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <ul><li>线程： thread，有时候被称为轻量级进程（Lightweight Process, LWP），是程序执行流的最小单元。</li> <li>协程： coroutine，又称微线程与子例程（或者称为函数）一样，也是一种程序组件。一种协作任务控制机制，在最简单的意义上，协程不是并发的。</li> <li>Goroutine： 最基础的执行单元，是支持并发的。每个go程序至少有一个goroutine，程序启动时，它会自动创建</li> <li>channel： 是go语言中各个并发结构体（goroutine）之前的通信机制。通俗地讲，就是各个<code>goroutine</code>间的通信管道，类似linux中的管道。传和取时，必阻塞，直到其他<code>goroutine</code>传或者取为止</li></ul> <h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <p>通过<code>goroutine</code>和<code>channel</code>实现</p> <h3 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h3> <p><a href="https://segmentfault.com/a/1190000018150987" target="_blank" rel="noopener noreferrer">Go goroutine理解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="todo"><a href="#todo" class="header-anchor">#</a> TODO</h3> <ul><li>指针</li> <li>寄存器</li> <li>类型接收器</li> <li>指针接收器</li> <li>值接收器</li></ul> <table><thead><tr><th>平台</th> <th>指针宽度和寄存器宽度</th></tr></thead> <tbody><tr><td>32位的平台</td> <td>4byte</td></tr> <tr><td>64位的平台</td> <td>8byte</td></tr></tbody></table> <h2 id="数据类型-2"><a href="#数据类型-2" class="header-anchor">#</a> 数据类型</h2> <h3 id="slice切片"><a href="#slice切片" class="header-anchor">#</a> slice切片</h3> <p>类似数组的概念，切片当前已开辟的内存，存储的元素数据是可安全读写的，开辟内存的方式可以是append或者修改声明的切片容量长度</p> <h4 id="切片内存扩容"><a href="#切片内存扩容" class="header-anchor">#</a> 切片内存扩容</h4> <h5 id="_1-预估容量"><a href="#_1-预估容量" class="header-anchor">#</a> 1. 预估容量</h5> <ul><li>扩容前容量 oldCap</li> <li>当前所需容量 cap</li> <li>预计扩容容量 newCap</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">if</span> oldCap <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">&lt;</span> <span class="token builtin">cap</span> <span class="token punctuation">{</span>
    newCap <span class="token operator">=</span> <span class="token builtin">cap</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> oldCap <span class="token operator">&lt;</span> <span class="token number">1024</span> <span class="token punctuation">{</span>
        newCap <span class="token operator">=</span> oldCap <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        newCap <span class="token operator">=</span> oldCap <span class="token operator">*</span> <span class="token number">1.25</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_2-分配内存"><a href="#_2-分配内存" class="header-anchor">#</a> 2. 分配内存</h5> <p>内存分为： 8 16 32 64 128 256...</p> <ul><li>预计占用内存 = 一个元素所占字节数 * 预计扩容容量</li> <li>实际占用内存 = 根据 预计占用内存 以就近原则往大值分配</li></ul> <h5 id="_3-获得容量"><a href="#_3-获得容量" class="header-anchor">#</a> 3. 获得容量</h5> <p>实际分配容量 = 实际占用内存 / 一个元素所占用字节数</p> <h3 id="interface接口"><a href="#interface接口" class="header-anchor">#</a> interface接口</h3> <p>由2个字组成，1个指向方法，1个指向数值</p> <h2 id="todo-2"><a href="#todo-2" class="header-anchor">#</a> TODO</h2> <ul><li>defer先定义后执行</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span>n <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">defer</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>
	<span class="token function">f</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 打印： 1 2 3</span>
</code></pre></div><ul><li>recover只能捕获到父级异常</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> <span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;catch&quot;</span><span class="token punctuation">)</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 打印： catch error</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>通过channel生产和消费，如果不生产或不消费，就会一直阻塞进程</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	messages <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		messages <span class="token operator">&lt;-</span> <span class="token string">&quot;test&quot;</span> <span class="token comment">// 生产</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	message <span class="token operator">:=</span> <span class="token operator">&lt;-</span>messages <span class="token comment">// 消费</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>生产channel位置必须是在协程里</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// fail</span>
	messages <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	messages <span class="token operator">&lt;-</span> <span class="token string">&quot;test&quot;</span> <span class="token comment">// 缺少一个父级goroutine接收 抛出异常</span>
	message <span class="token operator">:=</span> <span class="token operator">&lt;-</span>messages
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
	<span class="token comment">// success</span>
	messages <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		messages <span class="token operator">&lt;-</span> <span class="token string">&quot;test&quot;</span> <span class="token comment">// 等待父级goroutine接收</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	message <span class="token operator">:=</span> <span class="token operator">&lt;-</span>messages <span class="token comment">// 接收</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>设置channel数量</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	messages <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 设置数量</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		messages <span class="token operator">&lt;-</span> <span class="token string">&quot;test&quot;</span> <span class="token comment">// 生产</span>
		messages <span class="token operator">&lt;-</span> <span class="token string">&quot;test2&quot;</span> <span class="token comment">// 生产</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	message <span class="token operator">:=</span> <span class="token operator">&lt;-</span>messages <span class="token comment">// 消费</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
	message <span class="token operator">=</span> <span class="token operator">&lt;-</span>messages <span class="token comment">// 消费</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>计数器</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	waiter <span class="token operator">:=</span> <span class="token operator">&amp;</span>sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">{</span><span class="token punctuation">}</span>
	waiter<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 设定计数器</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> waiter<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 计数器 - 1</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;wait&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	waiter<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 等待计数器为0</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>定义接收器和发送器</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">reciver</span><span class="token punctuation">(</span>messages <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 接收器</span>
	messages <span class="token operator">&lt;-</span> message
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">poster</span><span class="token punctuation">(</span>messages <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 发送器</span>
	msg <span class="token operator">:=</span> <span class="token operator">&lt;-</span>messages
	message <span class="token operator">&lt;-</span> msg
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	messages <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token function">reciver</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
	messages2 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token function">poster</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> messages2<span class="token punctuation">)</span>
	<span class="token function">close</span><span class="token punctuation">(</span>messages2<span class="token punctuation">)</span> <span class="token comment">// 关闭后不可生产消息</span>
	<span class="token keyword">for</span> msg <span class="token operator">:=</span> <span class="token keyword">range</span> messages2 <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>超时处理</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 2s</span>
		c1 <span class="token operator">&lt;-</span> <span class="token string">&quot;res&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> msg <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c1<span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">// 1s</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;timeout&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/17/2024, 1:33:24 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/book/gao-xiao-ren-shi-de-qi-ge-xi-guan/" class="prev">
        高效能人士的七个习惯
      </a></span> <span class="next"><a href="/book/javascript-she-ji-mo-shi/">
        Javascript设计模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9feba9da.js" defer></script><script src="/assets/js/2.c4d23e8d.js" defer></script><script src="/assets/js/1.5c0c4e06.js" defer></script><script src="/assets/js/46.2896505d.js" defer></script>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PF595C3K" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8528418355033370" crossorigin="anonymous"></script>
    <script async src="https://fundingchoicesmessages.google.com/i/pub-8528418355033370?ers=1" nonce="kQLwSpQTRyU__T41cA9hSQ"></script><script nonce="kQLwSpQTRyU__T41cA9hSQ">(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>
</body>

</html>