import{_ as i,o as s,c as e,af as t}from"./chunks/framework.R7EdO4cN.js";const l="/assets/35645B35-7CC8-4EB9-8876-F354E6EABCA9.CIbE-Ugq.png",n="/assets/3330B1EC-9B91-4833-975B-8B51793C4E6A.DDm8EBTZ.png",r="/assets/C42CF5C1-73E1-43C5-8B3E-C1C533A81F22.Da5TJM78.png",p="/assets/E4EDB736-04B2-43D9-A9EE-388D6DCA8BD2.BQdBjIGI.png",o="/assets/13A3A798-3758-4E52-9BA3-569E7E8620EC.i1SBPJOw.png",h="/assets/20C3EDC8-CDD7-423F-BF89-188BC812F4D3.PHntKIQ0.png",c="/assets/F662E27B-E177-453F-A1A5-CDEEF54F647E.BioD2j27.png",d="/assets/B01D0388-038E-4FD9-AE89-6AAE0AB4635E.D52VWgZR.png",f=JSON.parse('{"title":"TCP&IP协议","description":"","frontmatter":{"title":"TCP&IP协议"},"headers":[],"relativePath":"notes/tcp-ip-xie-yi/index.md","filePath":"notes/tcp-ip-xie-yi/index.md"}'),k={name:"notes/tcp-ip-xie-yi/index.md"};function C(b,a,u,P,g,F){return s(),e("div",null,[...a[0]||(a[0]=[t('<h1 id="tcp-ip协议" tabindex="-1">TCP&amp;IP协议 <a class="header-anchor" href="#tcp-ip协议" aria-label="Permalink to &quot;TCP&amp;IP协议&quot;">​</a></h1><h2 id="osi七层协议" tabindex="-1">OSI七层协议 <a class="header-anchor" href="#osi七层协议" aria-label="Permalink to &quot;OSI七层协议&quot;">​</a></h2><p>网络通信问题：</p><ol><li>物理层： 网线，物理传输二进制数据</li><li>数据链路层： 保证数据双方正确发送和接收</li></ol><p>传输问题：</p><ol start="3"><li>网络层： IP，解决寻址问题</li><li>传输层： TCP，保证数据完整性</li></ol><p>应用进程：</p><ol start="5"><li>会话层： 用于管理会话</li><li>表示层： 按照接收方通信的语言，对传输内容进行封装，处理加解密，压缩解压</li><li>应用层： HTTP协议 DNS协议 按协议封装数据</li></ol><h2 id="tcp协议" tabindex="-1">TCP协议 <a class="header-anchor" href="#tcp协议" aria-label="Permalink to &quot;TCP协议&quot;">​</a></h2><p>TCP 是一个可靠的（reliable）、面向连接的（connection-oriented）、基于字节流（byte-stream）、全双工的（full-duplex）协议。</p><h3 id="三次握手" tabindex="-1">三次握手 <a class="header-anchor" href="#三次握手" aria-label="Permalink to &quot;三次握手&quot;">​</a></h3><p>建立连接的过程是通过「三次握手」来完成的，顾名思义，通过三次数据交换建立一个连接。 通过三次握手协商好双方后续通信的起始序列号、窗口缩放大小等信息。</p><p><img src="'+l+'" alt="cd6ab44c7347778a48c3d31707cd013a"></p><h3 id="特点" tabindex="-1">特点 <a class="header-anchor" href="#特点" aria-label="Permalink to &quot;特点&quot;">​</a></h3><p><img src="'+n+'" alt="78fb39c411b10150f83b6a99f75fa7f2"></p><h4 id="面向连接-connection-oriented" tabindex="-1">面向连接（connection-oriented） <a class="header-anchor" href="#面向连接-connection-oriented" aria-label="Permalink to &quot;面向连接（connection-oriented）&quot;">​</a></h4><p>面向连接的协议要求正式发送数据之前需要通过「握手」建立一个逻辑连接，结束通信时也是通过有序的四次挥手来断开连接。</p><h4 id="无连接-connectionless" tabindex="-1">无连接（connectionless） <a class="header-anchor" href="#无连接-connectionless" aria-label="Permalink to &quot;无连接（connectionless）&quot;">​</a></h4><p>无连接的协议则不需要</p><h4 id="可靠的-reliable" tabindex="-1">可靠的（reliable） <a class="header-anchor" href="#可靠的-reliable" aria-label="Permalink to &quot;可靠的（reliable）&quot;">​</a></h4><p>IP 是一种无连接、不可靠的协议：它尽最大可能将数据报从发送者传输给接收者，但并不保证包到达的顺序会与它们被传输的顺序一致，也不保证包是否重复，甚至都不保证包是否会达到接收者。</p><p>TCP 要想在 IP 基础上构建可靠的传输层协议，必须有一个复杂的机制来保障可靠性。</p><p>主要有下面几个方面：</p><ul><li>对每个包提供校验和</li><li>包的序列号解决了接收数据的乱序、重复问题</li><li>超时重传</li><li>流量控制、拥塞控制</li></ul><p><strong>校验和（checksum）：</strong></p><p>每个 TCP 包首部中都有两字节用来表示校验和，防止在传输过程中有损坏。如果收到一个校验和有差错的报文，TCP 不会发送任何确认直接丢弃它，等待发送端重传。</p><p><img src="'+r+'" alt="50ea3effc324f327cb271e7727ff9ab2"></p><p><strong>包的序列号保证了接收数据的乱序和重复问题：</strong></p><p>假设我们往 TCP 套接字里写 3000 字节的数据导致 TCP发送了 3 个数据包，每个数据包大小为 1000 字节：第一个包序列号为[1~1001)，第二个包序列号为 [1001~2001)，第三个包序号为[2001~3001)</p><p><img src="'+p+'" alt="19fab6f09715d9cfbac06a51257da605"></p><p>假如因为网络的原因导致第二个、第三个包先到接收端，第一个包最后才到，接收端也不会因为他们到达的顺序不一致把包弄错，TCP 会根据他们的序号进行重新的排列然后把结果传递给上层应用程序。</p><p>如果 TCP 接收到重复的数据，可能的原因是超时重传了两次但这个包并没有丢失，接收端会收到两次同样的数据，它能够根据包序号丢弃重复的数据。</p><p><strong>超时重传：</strong></p><p>TCP 发送数据后会启动一个定时器，等待对端确认收到这个数据包。如果在指定的时间内没有收到 ACK 确认，就会重传数据包，然后等待更长时间，如果还没有收到就再重传，在多次重传仍然失败以后，TCP 会放弃这个包。后面我们讲到超时重传模块的时候会详细介绍这部分内容。</p><p><strong>流量控制、拥塞控制：</strong></p><p>这部分内容较复杂，后面有专门的文章进行讲解，这里先不展开。</p><h4 id="基于字节流-byte-stream" tabindex="-1">基于字节流（byte-stream） <a class="header-anchor" href="#基于字节流-byte-stream" aria-label="Permalink to &quot;基于字节流（byte-stream）&quot;">​</a></h4><p>TCP 是一种字节流（byte-stream）协议，流的含义是没有固定的报文边界。</p><h4 id="全双工的-full-duplex" tabindex="-1">全双工的（full-duplex） <a class="header-anchor" href="#全双工的-full-duplex" aria-label="Permalink to &quot;全双工的（full-duplex）&quot;">​</a></h4><p>在 TCP 中发送端和接收端可以是客户端/服务端，也可以是服务器/客户端，通信的双方在任意时刻既可以是接收数据也可以是发送数据，每个方向的数据流都独立管理序列号、滑动窗口大小、MSS 等信息。</p><h2 id="网络分层设计" tabindex="-1">网络分层设计 <a class="header-anchor" href="#网络分层设计" aria-label="Permalink to &quot;网络分层设计&quot;">​</a></h2><h3 id="网络访问层-network-access-layer" tabindex="-1">网络访问层（Network Access Layer） <a class="header-anchor" href="#网络访问层-network-access-layer" aria-label="Permalink to &quot;网络访问层（Network Access Layer）&quot;">​</a></h3><p>网络访问层也有说法叫做网络接口层，以太网、Wifi、蓝牙工作在这一层，网络访问层提供了主机连接到物理网络需要的硬件和相关的协议。这一层我们不做重点讨论。</p><p><img src="'+o+'" alt="8c6407208d8a3a8ebfd678b09235db86"></p><h2 id="tcp报文头部" tabindex="-1">TCP报文头部 <a class="header-anchor" href="#tcp报文头部" aria-label="Permalink to &quot;TCP报文头部&quot;">​</a></h2><p><img src="'+h+`" alt="c84d5d225ea5fe6c502d07226dd6ffda"></p><ul><li>SYN（Synchronize）：用于发起连接数据包同步双方的初始序列号</li><li>ACK（Acknowledge）：确认数据包</li><li>RST（Reset）：这个标记用来强制断开连接，通常是之前建立的连接已经不在了、包不合法、或者实在无能为力处理</li><li>FIN（Finish）：通知对方我发完了所有数据，准备断开连接，后面我不会再发数据包给你了。</li><li>PSH（Push）：告知对方这些数据包收到以后应该马上交给上层应用，不能缓存起来</li></ul><h2 id="数据包" tabindex="-1">数据包 <a class="header-anchor" href="#数据包" aria-label="Permalink to &quot;数据包&quot;">​</a></h2><p><strong>MTU（Maximum Transmission Unit）：</strong> 最大传输单元</p><p><strong>MSS（Max Segment Size）：</strong> TCP 最大段大小</p><p>MSS = MTU - IP header头大小 - TCP 头大小</p><p>在以太网中 TCP 的 MSS = 1500（MTU） - 20（IP 头大小） - 20（TCP 头大小）= 1460</p><h2 id="端口号" tabindex="-1">端口号 <a class="header-anchor" href="#端口号" aria-label="Permalink to &quot;端口号&quot;">​</a></h2><p>一般1024~65525端口段可分配。</p><h3 id="标识" tabindex="-1">标识 <a class="header-anchor" href="#标识" aria-label="Permalink to &quot;标识&quot;">​</a></h3><p>链路层标识： MAC IP层标识： IP地址 传输层标识： 端口号</p><h3 id="检测端口号开启情况" tabindex="-1">检测端口号开启情况 <a class="header-anchor" href="#检测端口号开启情况" aria-label="Permalink to &quot;检测端口号开启情况&quot;">​</a></h3><p>使用 nc 和 telnet 这两个命令可以非常方便的查看到对方端口是否打开或者网络是否可达</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">telnet</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.211.55.12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Trying</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.211.55.12...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Connected</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.211.55.12.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Escape</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> character</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;^]&#39;.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.211.55.12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ncat:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Connected</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 10.211.55.12:6379</span></span></code></pre></div><h3 id="检测端口号占用情况" tabindex="-1">检测端口号占用情况 <a class="header-anchor" href="#检测端口号占用情况" aria-label="Permalink to &quot;检测端口号占用情况&quot;">​</a></h3><ol><li>使用 netstat</li></ol><p><img src="`+c+'" alt="b9139966dad2eeaa85cc55d60bf9e402"></p><ol start="2"><li>使用 lsof</li></ol><p><img src="'+d+'" alt="e1db2c8693c28cabae9c629133f4a5c2"></p>',64)])])}const E=i(k,[["render",C]]);export{f as __pageData,E as default};
