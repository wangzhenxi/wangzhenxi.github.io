<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SOLID原则 | Joshwong | 王震西</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="记录点滴">
    
    <link rel="preload" href="/assets/css/0.styles.344bd397.css" as="style"><link rel="preload" href="/assets/js/app.d2d77408.js" as="script"><link rel="preload" href="/assets/js/2.458f5d9f.js" as="script"><link rel="preload" href="/assets/js/1.0c122c21.js" as="script"><link rel="preload" href="/assets/js/29.3b530765.js" as="script"><link rel="prefetch" href="/assets/js/10.01f95f5a.js"><link rel="prefetch" href="/assets/js/11.37d75234.js"><link rel="prefetch" href="/assets/js/12.7ff158dd.js"><link rel="prefetch" href="/assets/js/13.e584d370.js"><link rel="prefetch" href="/assets/js/14.3d970367.js"><link rel="prefetch" href="/assets/js/15.1a153894.js"><link rel="prefetch" href="/assets/js/16.7d47f99b.js"><link rel="prefetch" href="/assets/js/17.9ea31b9b.js"><link rel="prefetch" href="/assets/js/18.1f467c9d.js"><link rel="prefetch" href="/assets/js/19.ea8cf457.js"><link rel="prefetch" href="/assets/js/20.1a39e54c.js"><link rel="prefetch" href="/assets/js/21.1debad62.js"><link rel="prefetch" href="/assets/js/22.8ee7dccd.js"><link rel="prefetch" href="/assets/js/23.3493907f.js"><link rel="prefetch" href="/assets/js/24.a1e14fd2.js"><link rel="prefetch" href="/assets/js/25.041a2c97.js"><link rel="prefetch" href="/assets/js/26.93eea02c.js"><link rel="prefetch" href="/assets/js/27.1dee5524.js"><link rel="prefetch" href="/assets/js/28.dbd65262.js"><link rel="prefetch" href="/assets/js/3.afc1d427.js"><link rel="prefetch" href="/assets/js/30.c56c3352.js"><link rel="prefetch" href="/assets/js/31.62d1dfb1.js"><link rel="prefetch" href="/assets/js/32.0c3b780f.js"><link rel="prefetch" href="/assets/js/33.a8e72346.js"><link rel="prefetch" href="/assets/js/34.434a8c42.js"><link rel="prefetch" href="/assets/js/35.5d611f44.js"><link rel="prefetch" href="/assets/js/36.6d5e0ee0.js"><link rel="prefetch" href="/assets/js/37.8fe17200.js"><link rel="prefetch" href="/assets/js/38.0d092310.js"><link rel="prefetch" href="/assets/js/39.bfb7d03a.js"><link rel="prefetch" href="/assets/js/4.9e22ea50.js"><link rel="prefetch" href="/assets/js/40.385011d5.js"><link rel="prefetch" href="/assets/js/41.bb5c9b28.js"><link rel="prefetch" href="/assets/js/42.db1e72be.js"><link rel="prefetch" href="/assets/js/43.57d9039c.js"><link rel="prefetch" href="/assets/js/44.9e2e3669.js"><link rel="prefetch" href="/assets/js/45.9c36889b.js"><link rel="prefetch" href="/assets/js/46.e80a5f90.js"><link rel="prefetch" href="/assets/js/47.6cc3e771.js"><link rel="prefetch" href="/assets/js/48.b3200b63.js"><link rel="prefetch" href="/assets/js/49.34b7acc1.js"><link rel="prefetch" href="/assets/js/5.3e1c9f3b.js"><link rel="prefetch" href="/assets/js/50.8f8d52d6.js"><link rel="prefetch" href="/assets/js/51.d86db219.js"><link rel="prefetch" href="/assets/js/52.3234c412.js"><link rel="prefetch" href="/assets/js/53.0b7b40dd.js"><link rel="prefetch" href="/assets/js/54.843cf776.js"><link rel="prefetch" href="/assets/js/55.e5c219e1.js"><link rel="prefetch" href="/assets/js/56.97cc907d.js"><link rel="prefetch" href="/assets/js/57.78d2c37c.js"><link rel="prefetch" href="/assets/js/58.52a393e4.js"><link rel="prefetch" href="/assets/js/59.ff8148a3.js"><link rel="prefetch" href="/assets/js/6.171beb9e.js"><link rel="prefetch" href="/assets/js/60.0a3c0269.js"><link rel="prefetch" href="/assets/js/61.76636cf6.js"><link rel="prefetch" href="/assets/js/62.0695e019.js"><link rel="prefetch" href="/assets/js/63.81f8b9b6.js"><link rel="prefetch" href="/assets/js/64.a055b74d.js"><link rel="prefetch" href="/assets/js/65.3a04ee3c.js"><link rel="prefetch" href="/assets/js/66.9daea5d9.js"><link rel="prefetch" href="/assets/js/67.9d3fb07b.js"><link rel="prefetch" href="/assets/js/68.b00829a4.js"><link rel="prefetch" href="/assets/js/69.960efa15.js"><link rel="prefetch" href="/assets/js/7.88176473.js"><link rel="prefetch" href="/assets/js/70.c25a9495.js"><link rel="prefetch" href="/assets/js/71.b72ce7a0.js"><link rel="prefetch" href="/assets/js/72.7ac3ecd0.js"><link rel="prefetch" href="/assets/js/73.ede29724.js"><link rel="prefetch" href="/assets/js/74.e475ecf3.js"><link rel="prefetch" href="/assets/js/75.b7663678.js"><link rel="prefetch" href="/assets/js/76.034cff83.js"><link rel="prefetch" href="/assets/js/77.8b799c69.js"><link rel="prefetch" href="/assets/js/78.881a3494.js"><link rel="prefetch" href="/assets/js/79.fbec1352.js"><link rel="prefetch" href="/assets/js/80.10bfbaa0.js"><link rel="prefetch" href="/assets/js/81.59c06275.js"><link rel="prefetch" href="/assets/js/82.ad696d56.js"><link rel="prefetch" href="/assets/js/83.60d0071f.js"><link rel="prefetch" href="/assets/js/84.7c295ad8.js"><link rel="prefetch" href="/assets/js/85.e2a2a98e.js"><link rel="prefetch" href="/assets/js/86.ffd4126b.js"><link rel="prefetch" href="/assets/js/87.1e343c08.js"><link rel="prefetch" href="/assets/js/88.351da4d0.js"><link rel="prefetch" href="/assets/js/89.5275e0d2.js"><link rel="prefetch" href="/assets/js/90.78db21bc.js"><link rel="prefetch" href="/assets/js/91.1b20c4df.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.b9e850a1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.344bd397.css">
    <!-- Google Tag Manager -->
    <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PF595C3K');
    </script>
    <!-- End Google Tag Manager -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K9LXC60XXJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-K9LXC60XXJ');
    </script>
</head>

<body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Joshwong | 王震西</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/wangzhenxi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/wangzhenxi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">关于我</a></li><li><a href="/friend/" class="sidebar-link">友情链接</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>读书笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>随笔</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/essay/docker/" class="sidebar-link">docker</a></li><li><a href="/essay/docker-compose/" class="sidebar-link">docker-compose</a></li><li><a href="/essay/google-seo/" class="sidebar-link">Google SEO</a></li><li><a href="/essay/investing/" class="sidebar-link">investing</a></li><li><a href="/essay/k8s/" class="sidebar-link">k8s</a></li><li><a href="/essay/lan-ya-ying-yong-kai-fa/" class="sidebar-link">蓝牙应用开发</a></li><li><a href="/essay/linux/" class="sidebar-link">Linux</a></li><li><a href="/essay/mysql/" class="sidebar-link">Mysql</a></li><li><a href="/essay/nginx/" class="sidebar-link">Nginx</a></li><li><a href="/essay/php/" class="sidebar-link">PHP</a></li><li><a href="/essay/phpunit/" class="sidebar-link">phpunit</a></li><li><a href="/essay/readme-gui-fan/" class="sidebar-link">README规范</a></li><li><a href="/essay/shell-script/" class="sidebar-link">Shell Script</a></li><li><a href="/essay/solid-principle/" aria-current="page" class="active sidebar-link">SOLID原则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/essay/solid-principle/#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/essay/solid-principle/#思考" class="sidebar-link">思考</a></li><li class="sidebar-sub-header"><a href="/essay/solid-principle/#什么是solid原则" class="sidebar-link">什么是SOLID原则？</a></li><li class="sidebar-sub-header"><a href="/essay/solid-principle/#使用和不使用solid原则的代码-有什么不一样" class="sidebar-link">使用和不使用SOLID原则的代码，有什么不一样？</a></li><li class="sidebar-sub-header"><a href="/essay/solid-principle/#solid原则对整体代码有什么影响" class="sidebar-link">SOLID原则对整体代码有什么影响？</a></li><li class="sidebar-sub-header"><a href="/essay/solid-principle/#如何在日常开发中应用solid原则" class="sidebar-link">如何在日常开发中应用SOLID原则？</a></li><li class="sidebar-sub-header"><a href="/essay/solid-principle/#如何在ddd中运用solid原则" class="sidebar-link">如何在DDD中运用SOLID原则？</a></li><li class="sidebar-sub-header"><a href="/essay/solid-principle/#知识衍生" class="sidebar-link">知识衍生</a></li></ul></li><li><a href="/essay/suan-fa/" class="sidebar-link">算法</a></li><li><a href="/essay/tcp-ip-xie-yi/" class="sidebar-link">TCP&amp;IP协议</a></li><li><a href="/essay/typescript/" class="sidebar-link">Typescript</a></li><li><a href="/essay/xing-neng-you-hua/" class="sidebar-link">性能优化</a></li><li><a href="/essay/yaml/" class="sidebar-link">YAML</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="solid原则"><a href="#solid原则" class="header-anchor">#</a> SOLID原则</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>SOLID原则是一组面向对象设计的五个基本原则。目的是创建可多人协作的、易于理解的、易读的以及可测试的代码。</p> <h2 id="思考"><a href="#思考" class="header-anchor">#</a> 思考</h2> <ul><li>什么是SOLID原则？</li> <li>使用和不使用SOLID原则的代码，有什么不一样？</li> <li>SOLID原则对整体代码有什么影响？</li> <li>如何在日常开发中应用SOLID原则？</li> <li>如何在DDD中运用SOLID原则？</li></ul> <h2 id="什么是solid原则"><a href="#什么是solid原则" class="header-anchor">#</a> 什么是SOLID原则？</h2> <p><a href="https://zh.wikipedia.org/wiki/SOLID_(%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1)" target="_blank" rel="noopener noreferrer">维基百科<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>： 在程序设计领域， SOLID（<strong>单一功能、开闭原则、里氏替换、接口隔离以及依赖反转</strong>）是由罗伯特·C·马丁在21世纪早期引入的记忆术首字母缩略字，指代了面向对象编程和面向对象设计的五个基本原则。当这些原则被一起应用时，它们<strong>使得一个程序员开发一个容易进行软件维护和扩展的系统变得更加可能</strong>。SOLID所包含的原则是通过引发程序设计者进行软件源代码的代码重构进行软件的代码异味清扫，从而使得软件清晰可读以及可扩展时可以应用的指南。SOLID被典型的应用在测试驱动开发上，并且是敏捷开发以及自适应软件开发的基本原则的重要组成部分。</p> <p><img src="/assets/img/2025-03-27-09-17-43.2f65d7fe.png" alt=""></p> <h3 id="设计的臭味-腐坏软件的气味"><a href="#设计的臭味-腐坏软件的气味" class="header-anchor">#</a> 设计的臭味—腐坏软件的气味</h3> <blockquote><p>使用SOLID原则可以帮助我们避免软件腐坏。</p></blockquote> <p>当软件出现下面任何一种气味时，就表明软件正在腐坏中。</p> <ol><li>僵化(Rigidity)：很难对系统进行改动，因为每处改动都会迫使系统其它部分进行许多改动。</li> <li>脆弱(Fragility)：对系统的改动会破坏在概念上与改动本身无关的其它地方。</li> <li>牢固(Immobility)：很难把系统的缠结解开，成为可被其它系统复用的组件。</li> <li>粘滞(Viscosity)：设计耦合在一起，导致代码的变更需要在多个地方进行。</li> <li>不必要的复杂性(Needless Complexity)：设计中包含没有直接好处的基础设施。</li> <li>不必要的重复(Needless Repetition)：设计中包含重复的结构，而该重复的结构本可以统一在单一的抽象之下。</li> <li>晦涩(Opacity)：很难阅读、理解。没有很好地表达出意图。</li></ol> <h2 id="使用和不使用solid原则的代码-有什么不一样"><a href="#使用和不使用solid原则的代码-有什么不一样" class="header-anchor">#</a> 使用和不使用SOLID原则的代码，有什么不一样？</h2> <h3 id="单一功能原则-srp-single-responsibility-principle"><a href="#单一功能原则-srp-single-responsibility-principle" class="header-anchor">#</a> 单一功能原则（SRP： Single Responsibility Principle）</h3> <blockquote><p>在SRP的语境中，我们把职责定义为“变化的原因”(a reason for change)。如果你有超过一个的动机去改变一个类，那么这个类就具有多种职责。</p></blockquote> <p>一个对象（类、方法等）应该<strong>只负责单一的职责</strong>。如果一个对象承担了过多的职责，那么在修改其中一个功能时，可能会影响到其他功能，导致代码难以维护和测试。</p> <h4 id="如何识别职责"><a href="#如何识别职责" class="header-anchor">#</a> 如何识别职责？</h4> <ul><li>如果一个功能的变化，不应该影响另一个功能，那么就可以分离为不同职责。</li> <li>如果一个功能的变化，应该影响另一个功能，那么识别为同一职责。</li></ul> <p>举例： 数据持久化和业务规则，业务规则往往会频繁变化，而持久化往往不会频繁变化</p> <p><img src="/assets/img/2025-03-31-08-48-12.5a6dec4a.png" alt=""></p> <h4 id="反例"><a href="#反例" class="header-anchor">#</a> 反例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 按用户维度，不使用单一功能原则的例子，尽可能简单易懂</span>
<span class="token comment">// 用户管理类 - 负责用户管理、报表生成、邮件发送、数据验证、数据库操作</span>
<span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> users<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 添加用户</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">generateReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token comment">// 生成报表</span>
        <span class="token keyword">let</span> report <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            report <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 的信息:\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            report <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">邮箱: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            report <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">注册时间: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>registerDate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> report<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">sendEmail</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 发送邮件</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">向 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 发送邮件: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">validateUserData</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 验证用户数据</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token operator">!</span>user<span class="token punctuation">.</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'用户数据不完整'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">saveToDatabase</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 保存到数据库</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">保存用户 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 到数据库</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> userManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    email<span class="token operator">:</span> <span class="token string">'john@example.com'</span><span class="token punctuation">,</span>
    registerDate<span class="token operator">:</span> <span class="token string">'2024-03-27'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

userManager<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">validateUserData</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">saveToDatabase</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">'欢迎注册!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userManager<span class="token punctuation">.</span><span class="token function">generateReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 问题:</span>
<span class="token comment">// 1. 这个类承担了太多职责:用户管理、报表生成、邮件发送、数据验证、数据库操作</span>
<span class="token comment">// 2. 如果需要修改报表格式或邮件发送方式，都需要修改这个类</span>
<span class="token comment">// 3. 难以测试，因为一个类包含了多个功能点</span>
<span class="token comment">// 4. 代码复用性差，比如其他地方需要单独的邮件发送功能就无法复用</span>
</code></pre></div><h4 id="正例"><a href="#正例" class="header-anchor">#</a> 正例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt： 对照上面的例子，使用单一功能原则的例子，尽可能简单易懂</span>
<span class="token comment">// 用户管理类 - 只负责用户的基本操作</span>
<span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> users<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getUser</span><span class="token punctuation">(</span>email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>email <span class="token operator">===</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用户验证类 - 只负责验证用户数据</span>
<span class="token keyword">class</span> <span class="token class-name">UserValidator</span> <span class="token punctuation">{</span>
    <span class="token function">validateUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token operator">!</span>user<span class="token punctuation">.</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'用户数据不完整'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用户存储类 - 只负责数据库操作</span>
<span class="token keyword">class</span> <span class="token class-name">UserStorage</span> <span class="token punctuation">{</span>
    <span class="token function">saveUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">保存用户 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 到数据库</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 报表生成类 - 只负责生成报表</span>
<span class="token keyword">class</span> <span class="token class-name">ReportGenerator</span> <span class="token punctuation">{</span>
    <span class="token function">generateUserReport</span><span class="token punctuation">(</span>users<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> report <span class="token operator">=</span> <span class="token string">'用户报表:\n'</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            report <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 的信息:\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            report <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">邮箱: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            report <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">注册时间: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>registerDate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> report<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 邮件服务类 - 只负责发送邮件</span>
<span class="token keyword">class</span> <span class="token class-name">EmailService</span> <span class="token punctuation">{</span>
    <span class="token function">sendEmail</span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">向 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>to<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 发送邮件: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> userManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> storage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reporter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReportGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> emailService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EmailService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    email<span class="token operator">:</span> <span class="token string">'john@example.com'</span><span class="token punctuation">,</span>
    registerDate<span class="token operator">:</span> <span class="token string">'2024-03-27'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 每个类都专注于自己的职责</span>
validator<span class="token punctuation">.</span><span class="token function">validateUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
storage<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
emailService<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>email<span class="token punctuation">,</span> <span class="token string">'欢迎注册!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reporter<span class="token punctuation">.</span><span class="token function">generateUserReport</span><span class="token punctuation">(</span>userManager<span class="token punctuation">.</span>users<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 好处:</span>
<span class="token comment">// 1. 每个类都有单一的职责，代码更清晰</span>
<span class="token comment">// 2. 易于维护，修改某个功能只需要改对应的类</span>
<span class="token comment">// 3. 易于测试，可以独立测试每个功能</span>
<span class="token comment">// 4. 代码复用性强，比如EmailService可以被其他模块使用</span>
</code></pre></div><h3 id="开闭原则-ocp-open-closed-principle"><a href="#开闭原则-ocp-open-closed-principle" class="header-anchor">#</a> 开闭原则（OCP： Open/Closed Principle）</h3> <p>软件实体（类、模块、函数等）应该<strong>对扩展开放</strong>，<strong>对修改关闭</strong>。也就是说，当需要添加新功能时，应该尽量不修改原有代码，而是通过扩展的方式来实现。</p> <h4 id="如何通过扩展而非修改来实现新功能"><a href="#如何通过扩展而非修改来实现新功能" class="header-anchor">#</a> 如何通过扩展而非修改来实现新功能？</h4> <p>在实现功能时：</p> <ul><li>确定系统中哪些功能或需求可能会变化，这些部分需要设计为可扩展的。通过将变化的部分封装在独立的模块中，而稳定的部分保持不变。</li> <li>可利用多态性，让子类可以通过不同的实现来满足不同的需求，而无需修改父类代码。</li> <li>使用抽象封闭变化。开发人员应该仅仅对程序中呈现出频繁变化的那些部分进行抽象。拒绝不成熟的抽象和抽象本身同等重要。</li></ul> <p>当需求变化时：</p> <ul><li>思考是否可以通过添加新的类或模块来实现新功能，而不需要修改已有的代码。</li> <li>尽早感知到需求变化的可能性，应尽早、尽快、经常发布，尽可能频繁地让用户使用新功能。</li></ul> <h4 id="反例-2"><a href="#反例-2" class="header-anchor">#</a> 反例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 按用户维度，不使用开闭原则的例子，尽可能简单易懂</span>
<span class="token comment">// 用户管理类 - 负责用户管理、报表生成</span>
<span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> users<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getUserReport</span><span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'basic'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'detailed'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 邮箱: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 注册时间: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>registerDate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'未知的报表类型'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> userManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'john@example.com'</span><span class="token punctuation">,</span> registerDate<span class="token operator">:</span> <span class="token string">'2024-03-27'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'jane@example.com'</span><span class="token punctuation">,</span> registerDate<span class="token operator">:</span> <span class="token string">'2024-03-28'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userManager<span class="token punctuation">.</span><span class="token function">getUserReport</span><span class="token punctuation">(</span><span class="token string">'basic'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userManager<span class="token punctuation">.</span><span class="token function">getUserReport</span><span class="token punctuation">(</span><span class="token string">'detailed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 问题:</span>
<span class="token comment">// 1. 如果需要添加新的报表类型，比如&quot;统计报表&quot;，必须修改getUserReport方法，违反开闭原则。</span>
<span class="token comment">// 2. 随着报表类型的增加，getUserReport方法会变得越来越复杂。</span>
</code></pre></div><h4 id="正例-2"><a href="#正例-2" class="header-anchor">#</a> 正例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 对照上面的例子，使用开闭原则的例子，尽可能简单易懂</span>
<span class="token comment">// 报表生成器接口</span>
<span class="token keyword">interface</span> <span class="token class-name">ReportGenerator</span> <span class="token punctuation">{</span>
    <span class="token function">generate</span><span class="token punctuation">(</span>users<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 基本报表生成器</span>
<span class="token keyword">class</span> <span class="token class-name">BasicReportGenerator</span> <span class="token keyword">implements</span> <span class="token class-name">ReportGenerator</span> <span class="token punctuation">{</span>
    <span class="token function">generate</span><span class="token punctuation">(</span>users<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 详细报表生成器</span>
<span class="token keyword">class</span> <span class="token class-name">DetailedReportGenerator</span> <span class="token keyword">implements</span> <span class="token class-name">ReportGenerator</span> <span class="token punctuation">{</span>
    <span class="token function">generate</span><span class="token punctuation">(</span>users<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 邮箱: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 注册时间: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>registerDate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用户管理类</span>
<span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> users<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> registerDate<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">generateReport</span><span class="token punctuation">(</span>generator<span class="token operator">:</span> ReportGenerator<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> generator<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> userManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'john@example.com'</span><span class="token punctuation">,</span> registerDate<span class="token operator">:</span> <span class="token string">'2024-03-27'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'jane@example.com'</span><span class="token punctuation">,</span> registerDate<span class="token operator">:</span> <span class="token string">'2024-03-28'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> basicReport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicReportGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> detailedReport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DetailedReportGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userManager<span class="token punctuation">.</span><span class="token function">generateReport</span><span class="token punctuation">(</span>basicReport<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userManager<span class="token punctuation">.</span><span class="token function">generateReport</span><span class="token punctuation">(</span>detailedReport<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 好处:</span>
<span class="token comment">// 1. 添加新报表类型时，只需创建一个新的报表生成器类，而无需修改现有代码。</span>
<span class="token comment">// 2. 遵循开闭原则，代码更易于扩展和维护。</span>
</code></pre></div><h3 id="里氏替换原则-lsp-liskov-substitution-principle"><a href="#里氏替换原则-lsp-liskov-substitution-principle" class="header-anchor">#</a> 里氏替换原则（LSP： Liskov Substitution Principle）</h3> <blockquote><p>开闭原则的实现依赖于里氏替换原则。</p></blockquote> <p>子类必须能够替换掉父类，并且程序的行为不变。也就是说，子类<strong>可以扩展父类的功能</strong>，但<strong>不能改变父类原有的功能</strong>。</p> <h4 id="如何满足里氏替换原则"><a href="#如何满足里氏替换原则" class="header-anchor">#</a> 如何满足里氏替换原则？</h4> <ul><li>基于契约设计（Design By Contract，DBC）： 可设定前置条件（入参的参数类型）和后置条件（函数的返回值），当子类实现时，前置条件不能比父类更严格，后置条件不能比父类更宽松。</li></ul> <h4 id="反例-3"><a href="#反例-3" class="header-anchor">#</a> 反例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 按用户维度，不使用里氏替换原则的例子，尽可能简单易懂</span>
<span class="token comment">// 父类 - 用户</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">public</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 邮箱: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 子类 - 特殊用户</span>
<span class="token keyword">class</span> <span class="token class-name">SpecialUser</span> <span class="token keyword">extends</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">public</span> discount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token comment">// 子类改变了父类的行为</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">特殊用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 邮箱: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 折扣: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>discount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">function</span> <span class="token function">printUserDetails</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'john@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> specialUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpecialUser</span><span class="token punctuation">(</span><span class="token string">'Jane'</span><span class="token punctuation">,</span> <span class="token string">'jane@example.com'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 用户: John, 邮箱: john@example.com</span>
<span class="token function">printUserDetails</span><span class="token punctuation">(</span>specialUser<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 特殊用户: Jane, 邮箱: jane@example.com, 折扣: 20%</span>

<span class="token comment">// 问题:</span>
<span class="token comment">// 1. SpecialUser改变了User类的行为，违反了里氏替换原则。</span>
<span class="token comment">// 2. 如果其他代码依赖于User类的行为（getDetails），可能会因为SpecialUser的行为改变而导致问题。</span>
</code></pre></div><h4 id="正例-3"><a href="#正例-3" class="header-anchor">#</a> 正例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 对照上面的例子，使用里氏替换原则的例子，尽可能简单易懂</span>
<span class="token comment">// 父类 - 用户</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">public</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 邮箱: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 子类 - 特殊用户</span>
<span class="token keyword">class</span> <span class="token class-name">SpecialUser</span> <span class="token keyword">extends</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">public</span> discount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getSpecialDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 折扣: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>discount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">function</span> <span class="token function">printUserDetails</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'john@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> specialUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpecialUser</span><span class="token punctuation">(</span><span class="token string">'Jane'</span><span class="token punctuation">,</span> <span class="token string">'jane@example.com'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 用户: John, 邮箱: john@example.com</span>
<span class="token function">printUserDetails</span><span class="token punctuation">(</span>specialUser<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 用户: Jane, 邮箱: jane@example.com</span>

<span class="token comment">// 好处:</span>
<span class="token comment">// 1. SpecialUser没有改变User类的行为，遵循了里氏替换原则。</span>
<span class="token comment">// 2. 子类扩展了父类的功能，而不是修改父类的行为。</span>
</code></pre></div><h3 id="接口隔离原则-isp-interface-segregation-principle"><a href="#接口隔离原则-isp-interface-segregation-principle" class="header-anchor">#</a> 接口隔离原则（ISP： Interface Segregation Principle）</h3> <p>接口设计应该遵守最小接口原则，<strong>避免实现不需要的方法</strong>，应该把“胖”接口中的方法分组，然后用多个接口替代它，让每一个接口服务于一个子模块。</p> <h4 id="如何识别胖接口"><a href="#如何识别胖接口" class="header-anchor">#</a> 如何识别胖接口？</h4> <ul><li>派生类不应该被迫依赖于它们不需要的方法： 如果一个接口包含了多个方法，而某些实现类只需要其中的一部分，那么这个接口就是一个胖接口。</li></ul> <h4 id="反例-4"><a href="#反例-4" class="header-anchor">#</a> 反例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 按用户维度，不使用接口隔离原则的例子，尽可能简单易懂</span>
<span class="token comment">// 一个胖接口，包含了所有用户相关的操作</span>
<span class="token keyword">interface</span> <span class="token class-name">UserOperations</span> <span class="token punctuation">{</span>
    <span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">deleteUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">generateReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">sendEmail</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 实现类 - 只需要部分功能，但必须实现整个接口</span>
<span class="token keyword">class</span> <span class="token class-name">BasicUserManager</span> <span class="token keyword">implements</span> <span class="token class-name">UserOperations</span> <span class="token punctuation">{</span>
    <span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">添加用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">deleteUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">删除用户ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">generateReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不需要此功能，但必须实现</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'不支持生成报表'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">sendEmail</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不需要此功能，但必须实现</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'不支持发送邮件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> userManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicUserManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 问题:</span>
<span class="token comment">// 1. BasicUserManager只需要部分功能，却被迫实现整个接口。</span>
<span class="token comment">// 2. 如果接口增加新方法，BasicUserManager也必须更新，导致维护困难。</span>
<span class="token comment">// 3. 违反接口隔离原则，接口设计不够精细。</span>
</code></pre></div><h4 id="正例-4"><a href="#正例-4" class="header-anchor">#</a> 正例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 对照上面的例子，使用接口隔离原则的例子，尽可能简单易懂</span>
<span class="token comment">// 将胖接口拆分为多个小接口</span>
<span class="token keyword">interface</span> <span class="token class-name">UserManagement</span> <span class="token punctuation">{</span>
    <span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">deleteUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ReportGeneration</span> <span class="token punctuation">{</span>
    <span class="token function">generateReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">EmailService</span> <span class="token punctuation">{</span>
    <span class="token function">sendEmail</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 实现类 - 只实现需要的接口</span>
<span class="token keyword">class</span> <span class="token class-name">BasicUserManager</span> <span class="token keyword">implements</span> <span class="token class-name">UserManagement</span> <span class="token punctuation">{</span>
    <span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">添加用户: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">deleteUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">删除用户ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> userManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicUserManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 好处:</span>
<span class="token comment">// 1. BasicUserManager只实现了需要的接口，避免了不必要的方法。</span>
<span class="token comment">// 2. 接口设计更精细，符合接口隔离原则。</span>
<span class="token comment">// 3. 易于维护，添加新功能不会影响现有实现类。</span>
</code></pre></div><h3 id="依赖反转原则-dip-dependency-inversion-principle"><a href="#依赖反转原则-dip-dependency-inversion-principle" class="header-anchor">#</a> 依赖反转原则（DIP： Dependency Inversion Principle）</h3> <p>高层模块不应该依赖于底层模块，两者都应该<strong>依赖于抽象</strong>。</p> <h4 id="如何实现依赖反转"><a href="#如何实现依赖反转" class="header-anchor">#</a> 如何实现依赖反转？</h4> <ul><li>层次化： 将接口按高层次和低层次分开</li> <li>倒置接口所有权： 高层次调用低层次的接口，而不是低层次调用高层次的接口</li> <li>依赖于抽象： 应用程序中所写的大多数具体类都具有不稳定性，所以高层次类不能直接依赖于这些不稳定的具体类。通过抽象的方式，把它们隐藏到抽象接口背后，就可以隔离这种不稳定性。</li></ul> <h4 id="反例-5"><a href="#反例-5" class="header-anchor">#</a> 反例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 按用户维度，不使用依赖反转原则的例子，尽可能简单易懂</span>
<span class="token comment">// 底层模块 - 邮件服务</span>
<span class="token keyword">class</span> <span class="token class-name">EmailService</span> <span class="token punctuation">{</span>
    <span class="token function">sendEmail</span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">向 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>to<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 发送邮件: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 高层模块 - 用户管理</span>
<span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> emailService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EmailService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 直接依赖具体实现</span>

    <span class="token function">notifyUser</span><span class="token punctuation">(</span>email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>emailService<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> userManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">notifyUser</span><span class="token punctuation">(</span><span class="token string">'john@example.com'</span><span class="token punctuation">,</span> <span class="token string">'欢迎注册!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 问题:</span>
<span class="token comment">// 1. UserManager直接依赖于EmailService的具体实现，违反了依赖反转原则。</span>
<span class="token comment">// 2. 如果需要更换邮件服务实现，比如改用第三方邮件服务，需要修改UserManager的代码。</span>
<span class="token comment">// 3. 高层模块和底层模块耦合度高，难以扩展和测试。</span>
</code></pre></div><h4 id="正例-5"><a href="#正例-5" class="header-anchor">#</a> 正例</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// prompt: 对照上面的例子，使用依赖反转原则的例子，尽可能简单易懂</span>
<span class="token comment">// 定义抽象接口</span>
<span class="token keyword">interface</span> <span class="token class-name">EmailService</span> <span class="token punctuation">{</span>
    <span class="token function">sendEmail</span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 实现具体的邮件服务</span>
<span class="token comment">// 底层模块依赖于抽象接口</span>
<span class="token keyword">class</span> <span class="token class-name">BasicEmailService</span> <span class="token keyword">implements</span> <span class="token class-name">EmailService</span> <span class="token punctuation">{</span>
    <span class="token function">sendEmail</span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">向 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>to<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 发送邮件: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 高层模块依赖于抽象接口</span>
<span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> emailService<span class="token operator">:</span> EmailService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">notifyUser</span><span class="token punctuation">(</span>email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>emailService<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> emailService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicEmailService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserManager</span><span class="token punctuation">(</span>emailService<span class="token punctuation">)</span><span class="token punctuation">;</span>
userManager<span class="token punctuation">.</span><span class="token function">notifyUser</span><span class="token punctuation">(</span><span class="token string">'john@example.com'</span><span class="token punctuation">,</span> <span class="token string">'欢迎注册!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 好处:</span>
<span class="token comment">// 1. UserManager依赖于EmailService接口，而不是具体实现，符合依赖反转原则。</span>
<span class="token comment">// 2. 更换邮件服务实现时，只需提供新的实现类，而无需修改UserManager代码。</span>
<span class="token comment">// 3. 高层模块和底层模块解耦，代码更易于扩展和测试。</span>
</code></pre></div><h2 id="solid原则对整体代码有什么影响"><a href="#solid原则对整体代码有什么影响" class="header-anchor">#</a> SOLID原则对整体代码有什么影响？</h2> <h3 id="总结原则"><a href="#总结原则" class="header-anchor">#</a> 总结原则</h3> <ul><li>单一功能原则（SRP）：强调单一职责，避免类过于庞大。</li> <li>开闭原则（OCP）：代码对扩展开放，对修改关闭。</li> <li>里氏替换原则（LSP）：子类可完全替代父类。</li> <li>接口隔离原则（ISP）：避免过大接口，提供专用接口。</li> <li>依赖反转原则（DIP）：高层模块不依赖低层实现，依赖抽象。</li></ul> <h3 id="综合优势"><a href="#综合优势" class="header-anchor">#</a> 综合优势</h3> <ul><li>提高代码可维护性：代码模块化，职责清晰，易于维护。</li> <li>增强扩展性：通过扩展而非修改，方便添加新功能。</li> <li>降低耦合性：模块之间依赖抽象，减少紧耦合。</li> <li>提升可测试性：依赖注入和接口导向使得单元测试更容易。</li></ul> <h2 id="如何在日常开发中应用solid原则"><a href="#如何在日常开发中应用solid原则" class="header-anchor">#</a> 如何在日常开发中应用SOLID原则？</h2> <h3 id="刻意练习"><a href="#刻意练习" class="header-anchor">#</a> 刻意练习</h3> <blockquote><p>我们除了去看优质的开源项目，了解其SOLID原则的体现外。还可以通过在日常开发工作中练习。</p></blockquote> <p>在活动相关业务中，有多种业务逻辑：</p> <ul><li>对接不同服务，常见的有发奖、抽奖、勋章、邀请、消息推送等；</li> <li>对接不同存储介质，有mysql、redis等；</li> <li>使用不同工具，有接口参数校验工具、并发控制工具等；</li> <li>代码有各种业务相关常量配置；</li></ul> <p>我们需分离关注点，将业务逻辑、数据访问等分开处理。例如：</p> <ul><li>单一功能原则： 如果接入新的服务，比如数据存储、消息推送等拆分为不同的服务实现；判断是否已发奖的逻辑，也放到对应服务实现；</li> <li>开闭原则： 如果有个性化功能，比如拉流水，不同活动可能用流水展示于现金券数量、抽奖机会数量等，可有个基类拉流水，再用子类实现个性化过滤和返回；</li> <li>里氏替换原则： 如果实现上需要修改功能，比如抽奖流水接口调整为仅返回剩余抽奖机会，修改了接口返回字段，可用新的接口实现，不要重写原有接口；</li> <li>接口隔离原则： 将胖接口拆分为多个小接口，避免实现不需要的方法。比如邀请服务有邀请、发放邀请人奖励，如果只需要做邀请操作不需要发奖时，会有不必要的实现，则可拆分为邀请接口、奖励接口；</li> <li>依赖反转原则： 如果服务依赖于具体实现，比如发奖服务依赖于奖励服务或者勋章服务实现，可将具体的服务实现抽象为接口，服务依赖于接口，而奖励和勋章服务的发奖接口可从外部传入</li></ul> <h3 id="请教ai"><a href="#请教ai" class="header-anchor">#</a> 请教AI</h3> <ul><li>编码时可以问下AI是否满足SOLID原则或者让他按照SOLID原则进行编码。
<img src="/assets/img/2025-03-28-09-34-31.80017b8b.png" alt=""> <img src="/assets/img/2025-03-28-09-35-39.684fa504.png" alt=""></li></ul> <h2 id="如何在ddd中运用solid原则"><a href="#如何在ddd中运用solid原则" class="header-anchor">#</a> 如何在DDD中运用SOLID原则？</h2> <h3 id="单一功能原则"><a href="#单一功能原则" class="header-anchor">#</a> 单一功能原则</h3> <ul><li>​核心思想​：每个软件实体仅承担一个职责。</li> <li>​DDD应用​：
<ul><li>​限界上下文（Bounded Context）​​：将复杂业务拆分为独立子领域，每个上下文内模型和服务的职责明确。例如，电商系统中&quot;订单管理&quot;和&quot;支付处理&quot;划分为不同上下文，避免耦合。</li> <li>​聚合根（Aggregate Root）​​：聚合根仅管理直接关联的实体和值对象。例如，订单聚合根仅处理订单状态和订单项，不涉及支付或物流逻辑。</li> <li>​领域服务分层​：通过分层架构（用户接口层、应用层、领域层、基础设施层）隔离业务与技术实现，确保领域层仅关注业务逻辑。</li></ul></li></ul> <h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h4> <p>订单聚合根（OrderAggregate）​​： 管理订单生命周期（创建/支付/取消）及订单项明细</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">OrderAggregate</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> items<span class="token operator">:</span> OrderItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> status<span class="token operator">:</span> <span class="token string">&quot;CREATED&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;PAID&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;CANCELED&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">// 仅处理订单状态变更</span>
  <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token string">&quot;CREATED&quot;</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;不可取消&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;CANCELED&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// ​单一职责体现​：订单聚合根不直接操作库存，仅通过事件驱动其他上下文。</span>
    DomainEvent<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OrderCancelledEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发布领域事件通知库存恢复</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​库存聚合根（InventoryAggregate）​​： 维护商品库存数量及扣减/恢复逻辑</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">InventoryAggregate</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> productId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> stock<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token comment">// 仅处理库存变更</span>
  <span class="token function">reduceStock</span><span class="token punctuation">(</span>quantity<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stock <span class="token operator">&lt;</span> quantity<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;库存不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stock <span class="token operator">-=</span> quantity<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 响应订单取消事件</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">EventHandler</span></span><span class="token punctuation">(</span>OrderCancelledEvent<span class="token punctuation">)</span>
  <span class="token function">handleOrderCancelled</span><span class="token punctuation">(</span>event<span class="token operator">:</span> OrderCancelledEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> order <span class="token operator">=</span> OrderRepository<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ​单一职责体现​：库存聚合根仅关注库存一致性，不耦合订单业务规则。</span>
    order<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">restoreStock</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>productId<span class="token punctuation">,</span> item<span class="token punctuation">.</span>quantity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="开闭原则"><a href="#开闭原则" class="header-anchor">#</a> 开闭原则</h3> <ul><li>核心思想​：对扩展开放，对修改封闭。</li> <li>​DDD应用​：
<ul><li>抽象接口定义​：通过接口定义领域能力，例如支付服务接口允许扩展新的支付方式（如支付宝、微信支付），无需修改现有代码。</li> <li>​领域事件（Domain Events）​​：通过事件驱动架构解耦业务逻辑。例如，订单创建后触发库存扣减事件，新增业务只需订阅事件而非修改核心流程。</li> <li>​策略模式​：在复杂业务规则（如折扣策略）中，通过策略接口实现动态扩展，避免硬编码条件分支。</li></ul></li></ul> <h4 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h4> <p>设计一个支持多种支付方式（微信、支付宝、银行卡）的系统，未来可能新增其他支付方式（如数字货币支付）。</p> <ol><li>抽象接口定义​： 通过接口定义支付行为的契约，所有支付方式实现该接口</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 支付策略接口（抽象层）</span>
<span class="token keyword">interface</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 微信支付策略（具体实现）</span>
<span class="token keyword">class</span> <span class="token class-name">WechatPayStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">微信支付成功：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">元</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DomainEvent<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PaymentSuccessEvent</span><span class="token punctuation">(</span><span class="token string">&quot;WechatPay&quot;</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发布领域事件</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 支付宝支付策略（具体实现）</span>
<span class="token keyword">class</span> <span class="token class-name">AlipayStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>
  <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">支付宝支付成功：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">元</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DomainEvent<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PaymentSuccessEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Alipay&quot;</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>策略模式应用​： 支付上下文类通过注入策略实现灵活切换</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">PaymentContext</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> strategy<span class="token operator">:</span> PaymentStrategy<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">executePayment</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> wechatPay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentContext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WechatPayStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wechatPay<span class="token punctuation">.</span><span class="token function">executePayment</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：微信支付成功：100元</span>
</code></pre></div><ol start="3"><li>领域事件扩展​： 新增支付方式时，只需扩展策略类并发布事件，无需修改其他代码</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 新增数字货币支付策略</span>
<span class="token keyword">class</span> <span class="token class-name">CryptoPayStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentStrategy</span> <span class="token punctuation">{</span>
    <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">数字货币支付成功：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">元</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DomainEvent<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PaymentSuccessEvent</span><span class="token punctuation">(</span><span class="token string">&quot;CryptoPay&quot;</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 事件监听模块（如订单服务）</span>
DomainEvent<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>PaymentSuccessEvent<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">订单已更新：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">支付完成，金额</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开闭原则体现​: ​</span>
<span class="token comment">// 对扩展开放​，新增支付方式只需添加 CryptoPayStrategy 类并实现接口。</span>
<span class="token comment">// 对修改关闭​，支付上下文 PaymentContext 和事件监听逻辑无需修改</span>
</code></pre></div><h3 id="里氏替换原则"><a href="#里氏替换原则" class="header-anchor">#</a> 里氏替换原则</h3> <ul><li>核心思想​：子类可无缝替换父类。</li> <li>​DDD应用​：
<ul><li>​资源库（Repository）实现​：不同存储方式（如数据库、缓存）需遵循统一资源库接口。例如，MySQL和Redis实现的订单资源库可互换，不影响领域层逻辑。</li> <li>​值对象（Value Object）设计​：确保值对象的行为一致性。例如，地址值对象的子类（如国际地址）需保持相同的行为契约。</li> <li>​领域服务接口约束​：子类实现领域服务接口时需遵循前置/后置条件，例如支付服务必须保证事务一致性。</li></ul></li></ul> <h4 id="示例-3"><a href="#示例-3" class="header-anchor">#</a> 示例</h4> <p>资源库（Repository）的设计： 通过抽象接口定义资源库操作，确保不同实现（如数据库、缓存）可替换而不影响业务逻辑。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 抽象接口定义（基类约束）</span>
<span class="token keyword">interface</span> <span class="token class-name">OrderRepository</span> <span class="token punctuation">{</span>
  <span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>OrderAggregate<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token function">save</span><span class="token punctuation">(</span>order<span class="token operator">:</span> OrderAggregate<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体实现（子类可替换）</span>
<span class="token keyword">class</span> <span class="token class-name">MySQLOrderRepository</span> <span class="token keyword">implements</span> <span class="token class-name">OrderRepository</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从MySQL查询订单聚合根</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM orders WHERE id = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>orderId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MongoOrderRepository</span> <span class="token keyword">implements</span> <span class="token class-name">OrderRepository</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从MongoDB查询订单聚合根</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> mongo<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> orderId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">processOrder</span><span class="token punctuation">(</span>orderId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> repository<span class="token operator">:</span> OrderRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token keyword">await</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 处理订单逻辑</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> mysqlRepo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLOrderRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mongoRepo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoOrderRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> mysqlRepo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用MySQL实现</span>
<span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">,</span> mongoRepo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用MongoDB实现</span>
<span class="token comment">// 里氏替换原则体现​：</span>
<span class="token comment">// 调用方仅依赖OrderRepository接口，无论底层是MySQL还是MongoDB实现，均不影响业务逻辑（如订单查询）的正确性。</span>
<span class="token comment">// 新增实现（如Redis缓存层）时无需修改现有代码，仅需扩展接口实现即可。</span>
</code></pre></div><p>值对象（Value Object）的设计： 通过无副作用操作，确保值对象子类不破坏父类行为。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 基础值对象（父类）</span>
<span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">public</span> <span class="token keyword">readonly</span> province<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> <span class="token keyword">readonly</span> city<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 无副作用方法，返回新实例</span>
  <span class="token function">updateCity</span><span class="token punctuation">(</span>newCity<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Address <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>province<span class="token punctuation">,</span> newCity<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 扩展值对象（子类）</span>
<span class="token keyword">class</span> <span class="token class-name">DetailedAddress</span> <span class="token keyword">extends</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    province<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    city<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> <span class="token keyword">readonly</span> street<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>province<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 不重写父类方法，仅扩展新方法</span>
  <span class="token function">getFullAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>province<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>street<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token string">&quot;广东省&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;深圳市&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newAddress <span class="token operator">=</span> address<span class="token punctuation">.</span><span class="token function">updateCity</span><span class="token punctuation">(</span><span class="token string">&quot;广州市&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> detailedAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DetailedAddress</span><span class="token punctuation">(</span><span class="token string">&quot;广东省&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;深圳市&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;南山区&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 里氏替换原则体现​：DetailedAddress继承Address后，所有使用Address的代码（如调用updateCity()）仍能正确运行，因为子类未覆盖父类方法。</span>
<span class="token keyword">const</span> newDetailedAddress <span class="token operator">=</span> detailedAddress<span class="token punctuation">.</span><span class="token function">updateCity</span><span class="token punctuation">(</span><span class="token string">&quot;广州市&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>detailedAddress<span class="token punctuation">.</span><span class="token function">getFullAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：广东省深圳市南山区</span>
</code></pre></div><p>领域服务接口约束： 通过接口定义领域服务的行为契约，确保不同策略实现可互换。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 抽象服务接口（基类约束）</span>
<span class="token keyword">interface</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>
  <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>PaymentResult<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体策略实现（子类可替换）</span>
<span class="token keyword">class</span> <span class="token class-name">WechatPayService</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用微信支付API</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> transactionId<span class="token operator">:</span> <span class="token string">&quot;WX-123&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">AlipayService</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">pay</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用支付宝API</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> transactionId<span class="token operator">:</span> <span class="token string">&quot;ALI-456&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 领域服务调用方（依赖抽象）</span>
<span class="token keyword">class</span> <span class="token class-name">OrderPaymentHandler</span> <span class="token punctuation">{</span>
  <span class="token comment">// 里氏替换原则体现​：OrderPaymentHandler仅依赖PaymentService接口，可无缝切换微信支付或支付宝实现。</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> paymentService<span class="token operator">:</span> PaymentService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">executePayment</span><span class="token punctuation">(</span>order<span class="token operator">:</span> OrderAggregate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paymentService<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>totalAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="接口隔离原则"><a href="#接口隔离原则" class="header-anchor">#</a> 接口隔离原则</h3> <ul><li>核心思想​：客户端不应依赖不需要的接口。</li> <li>​DDD应用​：
<ul><li>​细粒度领域服务​：按业务能力拆分接口。例如，&quot;订单查询服务&quot;和&quot;订单创建服务&quot;分离，避免单一接口臃肿。</li> <li>​基础设施接口隔离​：数据库访问、消息队列等技术实现通过适配器模式封装，领域层仅依赖抽象接口。</li></ul></li></ul> <h4 id="示例-4"><a href="#示例-4" class="header-anchor">#</a> 示例</h4> <p>订单服务需要支持创建、支付、物流跟踪等不同操作，但不同业务模块（如支付模块、物流模块）仅需部分接口能力。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 按职责拆分领域服务接口​</span>

<span class="token comment">// order-create-service.ts</span>
<span class="token comment">// 订单创建接口（仅订单服务核心职责）</span>
<span class="token keyword">interface</span> <span class="token class-name">IOrderCreationService</span> <span class="token punctuation">{</span>
  <span class="token function">createOrder</span><span class="token punctuation">(</span>orderData<span class="token operator">:</span> OrderDTO<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>OrderAggregate<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// order-query-service.ts</span>
<span class="token comment">// 订单支付接口（支付模块专用）</span>
<span class="token keyword">interface</span> <span class="token class-name">IOrderPaymentService</span> <span class="token punctuation">{</span>
  <span class="token comment">// 接口隔离原则体现​：</span>
  <span class="token comment">// 支付模块无需感知订单创建或物流跟踪的逻辑，减少无关接口依赖。</span>
  <span class="token comment">// 修改支付逻辑时，不影响其他模块。</span>
  <span class="token function">processPayment</span><span class="token punctuation">(</span>orderId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> paymentData<span class="token operator">:</span> PaymentDTO<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// order-query-service.ts</span>
<span class="token comment">// 订单物流接口（物流模块专用）</span>
<span class="token keyword">interface</span> <span class="token class-name">IOrderLogisticsService</span> <span class="token punctuation">{</span>
  <span class="token function">trackShipment</span><span class="token punctuation">(</span>orderId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ShipmentStatus<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// main.ts</span>
<span class="token comment">// 使用示例</span>
<span class="token comment">// 支付模块仅依赖支付接口</span>
<span class="token keyword">class</span> <span class="token class-name">PaymentModule</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> paymentService<span class="token operator">:</span> IOrderPaymentService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">handlePayment</span><span class="token punctuation">(</span>orderId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paymentService<span class="token punctuation">.</span><span class="token function">processPayment</span><span class="token punctuation">(</span>orderId<span class="token punctuation">,</span> <span class="token punctuation">{</span> amount<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>多数据库与外部服务适配： 系统需支持不同数据库（MySQL、MongoDB）和第三方服务（如短信、支付网关）。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 基础设施接口抽象</span>
<span class="token comment">// 仓储接口（领域层定义）</span>
<span class="token keyword">interface</span> <span class="token class-name">IOrderRepository</span> <span class="token punctuation">{</span>
  <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Order<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token function">save</span><span class="token punctuation">(</span>order<span class="token operator">:</span> Order<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 消息队列接口（基础设施层抽象）</span>
<span class="token keyword">interface</span> <span class="token class-name">IMessagePublisher</span> <span class="token punctuation">{</span>
  <span class="token function">publish</span><span class="token punctuation">(</span>event<span class="token operator">:</span> DomainEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体实现隔离​：</span>
<span class="token comment">// MySQL实现（写模型仓储）</span>
<span class="token comment">// 接口隔离原则体现​：切换数据库或消息队列时，无需修改业务逻辑。</span>
<span class="token keyword">class</span> <span class="token class-name">MySQLOrderRepository</span> <span class="token keyword">implements</span> <span class="token class-name">IOrderRepository</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM orders WHERE id = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// RabbitMQ实现（消息发布）</span>
<span class="token comment">// 接口隔离原则体现​：领域层仅依赖抽象接口，与具体技术实现解耦。</span>
<span class="token keyword">class</span> <span class="token class-name">RabbitMQPublisher</span> <span class="token keyword">implements</span> <span class="token class-name">IMessagePublisher</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">publish</span><span class="token punctuation">(</span>event<span class="token operator">:</span> DomainEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> rabbitmq<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;domain_events&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="依赖反转原则"><a href="#依赖反转原则" class="header-anchor">#</a> 依赖反转原则</h3> <blockquote><p>拓展知识：</p> <ul><li>六边形架构（<a href="https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)" target="_blank" rel="noopener noreferrer">Hexagonal Architecture<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）： 六边形架构或端口和适配器架构是软件设计中使用的一种架构模式。它旨在创建松散耦合的应用程序组件，这些组件可以通过端口和适配器轻松连接到其软件环境。这使得组件可以在任何级别进行更换，并促进测试自动化。</li></ul></blockquote> <ul><li>核心思想​：高层模块依赖抽象，而非具体实现。</li> <li>​DDD应用​：
<ul><li>​六边形架构（Hexagonal Architecture）​​：领域层位于核心，技术实现（如数据库、API）通过适配器注入，确保领域逻辑独立。</li> <li>​依赖注入（DI）​​：通过框架将资源库、外部服务等依赖注入领域层，例如订单服务依赖抽象的支付网关接口。</li> <li>​领域模型与技术解耦​：领域层定义接口，基础设施层实现。例如，领域事件发布接口由消息中间件（如Kafka）具体实现。</li></ul></li></ul> <h4 id="示例-5"><a href="#示例-5" class="header-anchor">#</a> 示例</h4> <p>六边形架构（Hexagonal Architecture）通过端口（Port）和适配器（Adapter）​的对称性设计，天然支持依赖反转原则。其核心机制包括：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 1. 端口定义抽象​：所有外部交互（如用户请求、数据库访问、第三方服务）均通过端口（接口）与核心业务逻辑通信。</span>
<span class="token comment">// 领域层定义抽象接口（端口）</span>
<span class="token keyword">interface</span> <span class="token class-name">OrderRepository</span> <span class="token punctuation">{</span>
  <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Order<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token function">save</span><span class="token punctuation">(</span>order<span class="token operator">:</span> Order<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 高层模块（应用服务）</span>
<span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
  <span class="token comment">// 依赖反转原则体现： 高层模块依赖于抽象。</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> orderRepository<span class="token operator">:</span> OrderRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 依赖注入，OrderService依赖于OrderRepository接口</span>

  <span class="token keyword">async</span> <span class="token function">processOrder</span><span class="token punctuation">(</span>orderId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理订单逻辑</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 适配器实现细节​：基础设施层通过适配器实现端口接口，例如数据库操作</span>
<span class="token comment">// 基础设施层实现适配器（依赖倒置）</span>
<span class="token keyword">class</span> <span class="token class-name">MySQLOrderRepository</span> <span class="token keyword">implements</span> <span class="token class-name">OrderRepository</span> <span class="token punctuation">{</span>
  <span class="token comment">// 依赖反转原则体现： 底层模块依赖于抽象。</span>
  <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM orders WHERE id = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> orderRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLOrderRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过依赖注入，OrderService使用MySQL实现</span>
<span class="token keyword">const</span> orderService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderService</span><span class="token punctuation">(</span>orderRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>
orderService<span class="token punctuation">.</span><span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>领域模型与技术解耦</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 1. 定义领域模型</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">public</span> <span class="token keyword">readonly</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> email<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">changeEmail</span><span class="token punctuation">(</span>newEmail<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>email <span class="token operator">=</span> newEmail<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 定义仓储接口（领域层）</span>
<span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token punctuation">{</span>
  <span class="token comment">// 依赖反转体现： ​领域模型​ User 无技术细节（如数据库注解）。</span>
  <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token function">save</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3. 基础设施层实现（TypeORM）</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Entity<span class="token punctuation">,</span> Column <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;typeorm&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entity</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UserDAO</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">PrimaryColumn</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token comment">// 数据库模型转领域模型</span>
  <span class="token function">toDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> User <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 领域模型转数据库模型</span>
  <span class="token keyword">static</span> <span class="token function">fromDomain</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span><span class="token operator">:</span> UserDAO <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dao<span class="token punctuation">.</span>id <span class="token operator">=</span> user<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    dao<span class="token punctuation">.</span>name <span class="token operator">=</span> user<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    dao<span class="token punctuation">.</span>email <span class="token operator">=</span> user<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
    <span class="token keyword">return</span> dao<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 4. 仓储实现（适配器）</span>
<span class="token keyword">class</span> <span class="token class-name">TypeORMUserRepository</span> <span class="token keyword">implements</span> <span class="token class-name">UserRepository</span> <span class="token punctuation">{</span>
  <span class="token comment">// 依赖反转体现： 仓储接口​ 由基础设施层实现，领域层不感知具体数据库。</span>
  <span class="token keyword">async</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dao <span class="token operator">=</span> <span class="token keyword">await</span> dataSource<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>UserDAO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOneBy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dao<span class="token operator">?.</span><span class="token function">toDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">save</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> dataSource<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span>UserDAO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>UserDAO<span class="token punctuation">.</span><span class="token function">fromDomain</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="知识衍生"><a href="#知识衍生" class="header-anchor">#</a> 知识衍生</h2> <ul><li><a href="https://blog.csdn.net/ASCIIZUO/article/details/126638034" target="_blank" rel="noopener noreferrer">UML图的六种箭头<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/essay/shell-script/" class="prev">
        Shell Script
      </a></span> <span class="next"><a href="/essay/suan-fa/">
        算法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d2d77408.js" defer></script><script src="/assets/js/2.458f5d9f.js" defer></script><script src="/assets/js/1.0c122c21.js" defer></script><script src="/assets/js/29.3b530765.js" defer></script>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PF595C3K" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8528418355033370" crossorigin="anonymous"></script>
    <script async src="https://fundingchoicesmessages.google.com/i/pub-8528418355033370?ers=1" nonce="kQLwSpQTRyU__T41cA9hSQ"></script><script nonce="kQLwSpQTRyU__T41cA9hSQ">(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>
</body>

</html>